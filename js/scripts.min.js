let quickLinkCounter=0;function updateAdPreview(){const title1=document.getElementById("title1"),title2=document.getElementById("title2"),text=document.getElementById("text"),clarifications=document.getElementById("clarifications"),url=document.getElementById("url"),displayUrl=document.getElementById("displayUrl"),phone=document.getElementById("phone"),workHours=document.getElementById("workHours"),yaContactElement=document.getElementById("yaContact"),combinedTitle=`${title1.value} ${title2.value}`.trim(),yaTitleElement=document.getElementById("yaTitle"),yaTextWithClarificationsElement=document.getElementById("yaTextWithClarifications"),yaUrlElement=document.getElementById("yaUrl");if(validateInput(title1,{maxLength:56,maxWordLength:22,maxPunctuation:15}),validateInput(title2,{maxLength:30,maxWordLength:22,maxPunctuation:15}),validateInput(text,{maxLength:81,maxWordLength:23,maxPunctuation:15}),validateInput(clarifications,{maxLength:132,maxPunctuation:25,countPunctuationWithSpaces:!0}),validateInput(url,{maxLength:1024}),validateInput(displayUrl,{maxLength:20}),yaTitleElement&&(yaTitleElement.textContent=combinedTitle),yaTextWithClarificationsElement){let combinedText=text.value;clarifications.value&&(combinedText+=`&nbsp;· ${clarifications.value}`),yaTextWithClarificationsElement.innerHTML=combinedText}const domainUrl=document.getElementById("domainUrl");if(yaUrlElement&&(yaUrlElement.innerHTML=`<b>${domainUrl.value}</b><span>&gt;</span>${displayUrl.value}...`),yaContactElement){let contactInfo=[];contactInfo.push('<span><a href="#">Контактная информация</a></span>'),phone.value&&contactInfo.push(`<span><a href="#">${phone.value} Показать</a></span>`),workHours.value&&contactInfo.push(`<span>${workHours.value}</span>`),yaContactElement.innerHTML=contactInfo.join("")}const yaQuickLinksElement=document.getElementById("yaQuickLinks"),yaAdditionalQuickLinksElement=document.getElementById("yaAdditionalQuickLinks");if(yaQuickLinksElement&&yaAdditionalQuickLinksElement){let quickLinksInfo=[],additionalQuickLinksInfo=[];const quickLinks=document.querySelectorAll(".quick-link-item");quickLinks.forEach((link,index)=>{const titleInput=link.querySelector('input[name="quickLinkTitle[]"]'),descriptionInput=link.querySelector('input[name="quickLinkDescription[]"]'),urlInput=link.querySelector('input[name="quickLinkUrl[]"]');validateInput(titleInput,{maxLength:30}),validateInput(descriptionInput,{maxLength:60}),validateInput(urlInput,{maxLength:1024});const title=titleInput.value,url=urlInput.value,description=descriptionInput.value;title&&url&&(index<4?quickLinksInfo.push(`<span><a href="${url}">${title}</a></span>`):additionalQuickLinksInfo.push(`\n                        <div class="Sitelinks-Item sitelinks__item">\n                            <a href="${url}">${title}</a>\n                            <div class="description">${description}</div>\n                        </div>\n                    `))}),yaQuickLinksElement.innerHTML=quickLinksInfo.join(""),additionalQuickLinksInfo.length>0?yaAdditionalQuickLinksElement.innerHTML=`\n                <div class="d-flex flex-wrap">\n                    ${additionalQuickLinksInfo.join("")}\n                </div>\n            `:yaAdditionalQuickLinksElement.innerHTML=""}saveFormData()}function validateInput(inputElement,constraints){const{maxLength:maxLength,maxWordLength:maxWordLength,maxPunctuation:maxPunctuation,countPunctuationWithSpaces:countPunctuationWithSpaces}=constraints,value=inputElement.value,words=value.split(/\s+/),punctuationRegex=countPunctuationWithSpaces?/[.,!?;:\s]/g:/[.,!?;:]/g,punctuationCount=(value.match(punctuationRegex)||[]).length,errorElement=document.getElementById(`${inputElement.id}-error`);let error="";value.length>maxLength?error=`Превышена максимальная длина (${maxLength} символов)`:maxWordLength&&words.some(word=>word.length>maxWordLength)?error=`Одно из слов превышает ${maxWordLength} символов`:maxPunctuation&&punctuationCount>maxPunctuation&&(error=`Превышено количество знаков препинания (макс. ${maxPunctuation})`),errorElement&&(errorElement.textContent=error,toggleErrorVisibility(errorElement)),inputElement.setCustomValidity(error)}function updateCharCount(input){const maxLength=input.maxLength;let currentLength,remainingChars=maxLength-input.value.length;const countElement=document.getElementById(`${input.id}-count`);countElement&&(countElement.textContent=remainingChars)}function updatePunctuationCount(input){const punctuationRegex="clarifications"===input.id?/[.,!?;:\s]/g:/[.,!?;:]/g,punctuationCount=(input.value.match(punctuationRegex)||[]).length,countElement=document.getElementById(`${input.id}-punctuation-count`);if(countElement){const maxPunctuation="clarifications"===input.id?25:15,remainingPunctuation=maxPunctuation-punctuationCount;countElement.textContent=remainingPunctuation}}function updateDomainUrl(){const urlInput=document.getElementById("url"),domainUrlInput=document.getElementById("domainUrl");try{const url=new URL(urlInput.value);domainUrlInput.value=url.hostname}catch(e){domainUrlInput.value=""}}function toggleErrorVisibility(errorElement){""===errorElement.textContent.trim()?(errorElement.style.display="none",errorElement.parentElement.classList.remove("was-validated")):(errorElement.style.display="block",errorElement.parentElement.classList.add("was-validated"))}function saveFormData(){const formData={title1:document.getElementById("title1").value,title2:document.getElementById("title2").value,text:document.getElementById("text").value,clarifications:document.getElementById("clarifications").value,url:document.getElementById("url").value,displayUrl:document.getElementById("displayUrl").value,phone:document.getElementById("phone").value,workHours:document.getElementById("workHours").value,quickLinks:Array.from(document.querySelectorAll(".quick-link-item")).map(item=>({title:item.querySelector('input[name="quickLinkTitle[]"]').value,description:item.querySelector('input[name="quickLinkDescription[]"]').value,url:item.querySelector('input[name="quickLinkUrl[]"]').value}))};localStorage.setItem("adFormData",JSON.stringify(formData))}function restoreFormData(){const savedData=JSON.parse(localStorage.getItem("adFormData"));if(savedData){document.getElementById("title1").value=savedData.title1||"",document.getElementById("title2").value=savedData.title2||"",document.getElementById("text").value=savedData.text||"",document.getElementById("clarifications").value=savedData.clarifications||"",document.getElementById("url").value=savedData.url||"",document.getElementById("displayUrl").value=savedData.displayUrl||"",document.getElementById("phone").value=savedData.phone||"",document.getElementById("workHours").value=savedData.workHours||"";const quickLinksFields=document.getElementById("quickLinksFields");quickLinksFields.innerHTML="",savedData.quickLinks&&savedData.quickLinks.forEach(link=>{addQuickLink(link)})}}function addQuickLink(linkData=null){const quickLinksFields=document.getElementById("quickLinksFields"),newQuickLink=document.createElement("div");newQuickLink.className="quick-link-item mb-2";const uniqueId=`ql_${quickLinkCounter++}`;newQuickLink.innerHTML=`\n        <div class="row g-2">\n            <div class="col-md-4">\n                <label for="quickLinkTitle-${uniqueId}" class="form-label text-info">Заголовок <span class="text-info small text-opacity-50">(еще <span id="quickLinkTitle-${uniqueId}-count">30</span> символов)</span></label>\n                <input type="text" class="form-control" id="quickLinkTitle-${uniqueId}" name="quickLinkTitle[]" placeholder="Заголовок" maxlength="30">\n                <div class="invalid-feedback" id="quickLinkTitle-${uniqueId}-error"></div>\n            </div>\n            <div class="col-md-4">\n                <label for="quickLinkDescription-${uniqueId}" class="form-label text-info">Описание <span class="text-info small text-opacity-50">(еще <span id="quickLinkDescription-${uniqueId}-count">60</span> символов)</span></label>\n                <input type="text" class="form-control" id="quickLinkDescription-${uniqueId}" name="quickLinkDescription[]" placeholder="Описание" maxlength="60">\n                <div class="invalid-feedback" id="quickLinkDescription-${uniqueId}-error"></div>\n            </div>\n            <div class="col-md-3">\n                <label for="quickLinkUrl-${uniqueId}" class="form-label text-info">Ссылка</label>\n                <input type="url" class="form-control" id="quickLinkUrl-${uniqueId}" name="quickLinkUrl[]" placeholder="Ссылка" maxlength="1024">\n                <div class="invalid-feedback" id="quickLinkUrl-${uniqueId}-error"></div>\n            </div>\n            <div class="col-md-1 d-flex align-items-end">\n                <button type="button" class="btn btn-outline-danger remove-quick-link">&times;</button>\n            </div>\n        </div>\n    `,quickLinksFields.appendChild(newQuickLink),newQuickLink.querySelector(".remove-quick-link").addEventListener("click",(function(){quickLinksFields.removeChild(newQuickLink),updateQuickLinkCount(),updateAdPreview()}));const inputs=newQuickLink.querySelectorAll("input");linkData&&(inputs[0].value=linkData.title||"",inputs[1].value=linkData.description||"",inputs[2].value=linkData.url||""),inputs.forEach(input=>{input.addEventListener("input",(function(event){updateCharCount(event.target),updateAdPreview()})),updateCharCount(input)}),updateQuickLinkCount(),updateAdPreview()}function updateQuickLinkCount(){const quickLinkCount=document.querySelectorAll(".quick-link-item").length,addQuickLinkButton=document.getElementById("addQuickLink");addQuickLinkButton.style.display=quickLinkCount>=8?"none":"block"}document.addEventListener("DOMContentLoaded",()=>{const form=document.getElementById("adForm"),inputs=form.querySelectorAll("input");restoreFormData(),updateDomainUrl(),updateAdPreview(),inputs.forEach(input=>{input.addEventListener("input",event=>{updateAdPreview(),updateCharCount(event.target),updatePunctuationCount(event.target),"url"===input.id&&updateDomainUrl()}),updateCharCount(input),updatePunctuationCount(input)}),document.getElementById("addQuickLink").addEventListener("click",()=>addQuickLink())});